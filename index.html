<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>द्राक्ष नोंदवाई</title>
  <style>
    /* Same styles as before */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
      color: #333;
    }
    h2 {
      text-align: center;
      color: #444;
      margin-top: 20px;
    }
    #input-section, #filter-section {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .input-group, .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: space-between;
    }
    .input-group input, .input-group select,
    .filter-group input, .filter-group select {
      flex: 1 1 48%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      outline: none;
    }
    .input-group input:focus, .input-group select:focus,
    .filter-group input:focus, .filter-group select:focus {
      border-color: #007BFF;
    }
    button {
      background-color: #007BFF;
      color: #fff;
      border: none;
      padding: 10px 15px;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #eaeaea;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tbody tr:hover {
      background-color: #f1f1f1;
    }
    .actions {
      text-align: center;
      margin: 20px;
    }
    .actions button {
      margin: 0 10px;
    }
    .delete-btn {
      background-color: #ff4d4d;
      margin: 5px;
    }
    .delete-btn:hover {
      background-color: #cc0000;
    }
  </style>
</head>
<body>
  <h2>द्राक्ष नोंदवाई फॉर्म</h2>
  
  <!-- Input Section -->
  <div id="input-section">
    <div class="input-group">
      <input type="number" id="serialNumber" placeholder="Serial Number" required>
      <input type="date" id="date" required>
      <input type="number" id="daysAfter" placeholder="छाटणी नंतरचे दिवस" required>
      <input type="text" id="medicineName" placeholder="औषध व खतांचे नाव" required>
      <input type="text" id="dosePerLiter" placeholder="औषधाची मात्रा प्रति लिटर">
      <input type="text" id="dosePerPlot" placeholder="औषधाची मात्रा प्रती प्लॉट">
      <input type="text" id="waterPerPlot" placeholder="पाणी प्रती प्लॉट">
      <input type="text" id="sprayTime" placeholder="फवारणीची वेळ">
      <!-- Dropdown for plot selection -->
      <select id="plotSelection" required>
        <option value="" disabled selected>प्लॉट निवडा</option>
      </select>
    </div>
    <div style="text-align: center; margin-top: 15px;">
      <button onclick="addRowFromInputs()">टेबलमध्ये जोडा</button>
    </div>
  </div>

  <!-- Filter Section -->
  <div id="filter-section">
    <h3>फिल्टर पर्याय</h3>
    <div class="filter-group">
      <select id="filterPlot" onchange="filterTable()">
        <option value="">सर्व प्लॉट्स</option>
      </select>
      <input type="date" id="filterDate" onchange="filterTable()">
      <input type="number" id="filterYear" placeholder="वर्ष" onchange="filterTable()">
    </div>
  </div>

  <!-- Plot Add Section -->
  <div class="actions">
    <input type="text" id="newPlotName" placeholder="नवीन प्लॉट जोडा">
    <button onclick="addPlot()">प्लॉट जोडा</button>
  </div>

  <!-- Table -->
  <table>
    <thead>
      <tr>
        <th>Serial Number</th>
        <th>दिनांक</th>
        <th>छाटणी नंतरचे दिवस</th>
        <th>औषध व खतांचे नाव</th>
        <th>औषधाची मात्रा प्रति लिटर</th>
        <th>औषधाची मात्रा प्रती प्लॉट</th>
        <th>पाणी प्रती प्लॉट</th>
        <th>फवारणीची वेळ</th>
        <th>प्लॉट</th>
        <th>क्रिया</th>
      </tr>
    </thead>
    <tbody id="table-body">
      <!-- Rows will be added dynamically -->
    </tbody>
  </table>

  <!-- Save and Load Section -->
  <div class="actions">
    <button onclick="saveData()">डेटा सेव्ह करा</button>
    <button onclick="loadData()">डेटा लोड करा</button>
  </div>

  <script>
    function addRowFromInputs() {
      const serialNumber = document.getElementById("serialNumber").value;
      const date = document.getElementById("date").value;
      const daysAfter = document.getElementById("daysAfter").value;
      const medicineName = document.getElementById("medicineName").value;
      const dosePerLiter = document.getElementById("dosePerLiter").value;
      const dosePerPlot = document.getElementById("dosePerPlot").value;
      const waterPerPlot = document.getElementById("waterPerPlot").value;
      const sprayTime = document.getElementById("sprayTime").value;
      const plotSelection = document.getElementById("plotSelection").value;

      if (!serialNumber || !date || !daysAfter || !medicineName || !plotSelection) {
        alert("कृपया सर्व आवश्यक फील्ड भरा.");
        return;
      }

      const tableBody = document.getElementById("table-body");
      const newRow = document.createElement("tr");
      newRow.innerHTML = `
        <td>${serialNumber}</td>
        <td>${date}</td>
        <td>${daysAfter}</td>
        <td>${medicineName}</td>
        <td>${dosePerLiter}</td>
        <td>${dosePerPlot}</td>
        <td>${waterPerPlot}</td>
        <td>${sprayTime}</td>
        <td>${plotSelection}</td>
        <td><button class="delete-btn" onclick="deleteRow(this)">हटवा</button></td>
      `;
      tableBody.appendChild(newRow);
      updateFilterPlots();

      document.querySelectorAll("#input-section input").forEach(input => input.value = "");
      document.getElementById("plotSelection").selectedIndex = 0;
    }

    function addPlot() {
      const newPlotName = document.getElementById("newPlotName").value.trim();
      if (!newPlotName) {
        alert("कृपया वैध प्लॉट नाव प्रविष्ट करा.");
        return;
      }

      const plotSelection = document.getElementById("plotSelection");
      const filterPlot = document.getElementById("filterPlot");
      const existingOptions = Array.from(plotSelection.options).map(option => option.value);

      if (!existingOptions.includes(newPlotName)) {
        const newOption = document.createElement("option");
        newOption.value = newPlotName;
        newOption.textContent = newPlotName;
        plotSelection.appendChild(newOption);
        filterPlot.appendChild(newOption.cloneNode(true));
        alert("प्लॉट यशस्वीरित्या जोडला!");
      } else {
        alert("हा प्लॉट आधीच जोडलेला आहे.");
      }

      document.getElementById("newPlotName").value = "";
    }

    function updateFilterPlots() {
      const filterPlot = document.getElementById("filterPlot");
      const tableBody = document.getElementById("table-body");
      const plots = new Set();

      tableBody.querySelectorAll("tr").forEach(row => {
        const plot = row.children[8]?.textContent || "";
        if (plot) plots.add(plot);
      });

      filterPlot.innerHTML = `<option value="">सर्व प्लॉट्स</option>`;
      plots.forEach(plot => {
        const option = document.createElement("option");
        option.value = plot;
        option.textContent = plot;
        filterPlot.appendChild(option);
      });
    }

    function filterTable() {
      const filterPlot = document.getElementById("filterPlot").value.toLowerCase();
      const filterDate = document.getElementById("filterDate").value;
      const filterYear = document.getElementById("filterYear").value;

      const rows = document.querySelectorAll("#table-body tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        const plot = cells[8]?.textContent.toLowerCase();
        const date = cells[1]?.textContent;
        const year = date ? new Date(date).getFullYear() : "";

        const plotMatch = !filterPlot || plot === filterPlot;
        const dateMatch = !filterDate || date === filterDate;
        const yearMatch = !filterYear || year == filterYear;

        row.style.display = plotMatch && dateMatch && yearMatch ? "" : "none";
      });
    }

    function deleteRow(button) {
      const row = button.parentElement.parentElement;
      row.remove();
      updateFilterPlots();
    }

    function saveData() {
      const rows = document.querySelectorAll("#table-body tr");
      const data = Array.from(rows).map(row => {
        const cells = row.querySelectorAll("td");
        return Array.from(cells).map(cell => cell.textContent);
      });
      localStorage.setItem("tableData", JSON.stringify(data));
      alert("डेटा यशस्वीरित्या सेव्ह केला!");
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem("tableData")) || [];
      const tableBody = document.getElementById("table-body");
      tableBody.innerHTML = ""; // Clear existing rows
      data.forEach(rowData => {
        const newRow = document.createElement("tr");
        newRow.innerHTML = rowData
          .map((value, index) => `<td>${value}</td>`)
          .join("") + `<td><button class="delete-btn" onclick="deleteRow(this)">हटवा</button></td>`;
        tableBody.appendChild(newRow);
      });
      updateFilterPlots();
    }
  </script>
</body>
</html>
